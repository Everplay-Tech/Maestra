# ============================================================================
# OrchestraSynth Build Configuration
# ============================================================================
# Copy this file to build.env and customize for your environment
# Then source it before building: source config/build.env
#
# IMPORTANT: Never commit build.env (contains credentials)
# ============================================================================

# ============================================================================
# Code Signing Configuration
# ============================================================================

# Developer ID Application certificate (REQUIRED for production)
# Find your identity with: security find-identity -v -p codesigning
# Example: "Developer ID Application: Your Company Name (TEAM123ABC)"
export CODESIGN_IDENTITY="Developer ID Application: Your Company (TEAMID)"

# Optional: Specify keychain containing signing certificate
# Leave empty to use default login keychain
# export CODESIGN_KEYCHAIN="/Users/you/Library/Keychains/signing.keychain-db"

# Optional: Developer ID Installer certificate (for PKG signing)
# Find with: security find-identity -v -p basic
# If not set, PKG will be created but not signed
# export PKG_SIGNING_IDENTITY="Developer ID Installer: Your Company (TEAMID)"

# ============================================================================
# Notarization Configuration
# ============================================================================

# Apple ID for notarization (REQUIRED for production)
export NOTARIZE_APPLE_ID="you@yourcompany.com"

# Apple Developer Team ID (REQUIRED for production)
# Find at: https://developer.apple.com/account
export NOTARIZE_TEAM_ID="TEAM123ABC"

# App-specific password or keychain profile (REQUIRED for production)
# Option 1: Use app-specific password directly
#   Generate at: https://appleid.apple.com/account/manage
# export NOTARIZE_PASSWORD="xxxx-xxxx-xxxx-xxxx"

# Option 2: Use keychain profile (RECOMMENDED for security)
#   Setup with: xcrun notarytool store-credentials "AC_PASSWORD" \
#     --apple-id "you@yourcompany.com" \
#     --team-id "TEAM123ABC" \
#     --password "xxxx-xxxx-xxxx-xxxx"
export NOTARIZE_PASSWORD="AC_PASSWORD"
export NOTARIZE_USE_KEYCHAIN="1"

# Optional: Notarization timeout in seconds (default: 3600)
# export NOTARIZE_WAIT_TIMEOUT="7200"

# ============================================================================
# Build Configuration
# ============================================================================

# Build configuration: Release, Debug, RelWithDebInfo
export BUILD_CONFIG="Release"

# Build directory (default: build/macos-universal-release)
# export BUILD_DIR="build/custom-build-dir"

# Build number for version tracking (optional)
# Useful for CI/CD pipelines
# export BUILD_NUMBER="$(date +%Y%m%d%H%M%S)"

# CMake generator: Ninja, "Unix Makefiles", Xcode
# Auto-detected if not set (prefers Ninja)
# export GENERATOR="Ninja"

# ============================================================================
# Package Configuration
# ============================================================================

# Override package version (default: from CMakeLists.txt)
# export PKG_VERSION="1.0.0"

# Custom PKG output directory
# export PKG_OUTPUT_DIR="dist/packages"

# ============================================================================
# Company/Product Configuration
# ============================================================================

# Company name (used in bundle IDs and certificates)
export COMPANY_NAME="Your Company"

# Product name
export PRODUCT_NAME="OrchestraSynth"

# Bundle ID prefix (reverse DNS notation)
# Default: com.yourcompany.orchestrasynth
# export BUNDLE_ID_PREFIX="com.yourcompany.orchestrasynth"

# ============================================================================
# Development/Testing Flags
# ============================================================================

# Skip code signing (TESTING ONLY - not for production)
# export SKIP_CODESIGN="1"

# Skip plugin signing (useful for standalone-only testing)
# export SKIP_PLUGIN_SIGNING="1"

# ============================================================================
# CI/CD Integration
# ============================================================================

# These variables are typically set by CI/CD systems
# Uncomment and customize as needed for your pipeline

# GitHub Actions
# export CI="true"
# export GITHUB_ACTIONS="true"
# export GITHUB_WORKFLOW="Build"
# export GITHUB_RUN_NUMBER="123"

# GitLab CI
# export CI="true"
# export GITLAB_CI="true"
# export CI_PIPELINE_ID="123"

# Jenkins
# export BUILD_ID="123"
# export BUILD_NUMBER="123"

# ============================================================================
# Verification
# ============================================================================

# Print configuration (useful for debugging)
echo "════════════════════════════════════════════════════════════"
echo "OrchestraSynth Build Configuration Loaded"
echo "════════════════════════════════════════════════════════════"
echo ""
echo "Code Signing:"
echo "  Identity: ${CODESIGN_IDENTITY:-[NOT SET]}"
echo "  PKG Identity: ${PKG_SIGNING_IDENTITY:-[NOT SET]}"
echo ""
echo "Notarization:"
echo "  Apple ID: ${NOTARIZE_APPLE_ID:-[NOT SET]}"
echo "  Team ID: ${NOTARIZE_TEAM_ID:-[NOT SET]}"
echo "  Using Keychain: ${NOTARIZE_USE_KEYCHAIN:-0}"
echo ""
echo "Build:"
echo "  Configuration: ${BUILD_CONFIG:-Release}"
echo "  Build Number: ${BUILD_NUMBER:-[NOT SET]}"
echo ""
echo "Company/Product:"
echo "  Company: ${COMPANY_NAME:-Your Company}"
echo "  Product: ${PRODUCT_NAME:-OrchestraSynth}"
echo ""
echo "════════════════════════════════════════════════════════════"
echo ""

# Validate critical variables for production builds
if [ "$SKIP_CODESIGN" != "1" ]; then
    if [ -z "$CODESIGN_IDENTITY" ]; then
        echo "⚠️  WARNING: CODESIGN_IDENTITY not set"
        echo "   Production builds require code signing"
    fi

    if [ -z "$NOTARIZE_APPLE_ID" ] || [ -z "$NOTARIZE_TEAM_ID" ] || [ -z "$NOTARIZE_PASSWORD" ]; then
        echo "⚠️  WARNING: Notarization credentials incomplete"
        echo "   Production builds require notarization"
    fi
fi
